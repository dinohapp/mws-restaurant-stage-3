"use strict";var restaurant=void 0,review=void 0,map=void 0;window.initMap=function(){fetchRestaurantFromURL().then(function(e){self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:e.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map)}).catch(function(e){return console.log("map error"+e)})};var fetchRestaurantFromURL=function(){if(self.restaurant)return Promise.resolve(self.restaurant);var e=getParameterByName("id");return e?DBHelper.fetchRestaurantById(e).then(function(e){return e?(self.restaurant=e,fillRestaurantHTML(),Promise.resolve(e)):Promise.reject("error getting restaurant with that id")}):Promise.reject("No restaurant id in URL")},fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("restaurant-name");t.innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var n=document.getElementById("restaurant-img");n.className="restaurant-img lazyload",n.src=DBHelper.imageUrlForRestaurant(e),n.alt=DBHelper.imageAltForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type;var r=document.createElement("button");r.className="favButton","true"==e.is_favorite?r.innerHTML="  ★":r.innerHTML="  ☆",r.setAttribute("aria-label","add restaurant as favorite"),r.onclick=function(){"false"==e.is_favorite?(e.is_favorite="true",r.innerHTML="  ★"):(e.is_favorite="false",r.innerHTML="  ☆"),DBHelper.toggleFavorite(e.id,e.is_favorite)},t.append(r),e.operating_hours&&fillRestaurantHoursHTML(),DBHelper.fetchReviews(e.id).then(function(e){self.reviews=e.reverse(),fillReviewsHTML(e)})},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);var i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}},fillReviewsHTML=function(e){self.reviews=e;var t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",t.appendChild(n),!e){var r=document.createElement("p");return r.innerHTML="No reviews yet!",void t.appendChild(r)}var a=document.getElementById("reviews-list");e.forEach(function(e){e.restaurant_id==restaurant.id&&a.appendChild(createReviewHTML(e))}),t.appendChild(a)},createReviewHTML=function(e){var t=document.createElement("li");if(0==navigator.onLine){var n=document.createElement("p");n.innerHTML="The review will be posted once online",t.appendChild(n)}var r=document.createElement("p");r.innerHTML=e.name,t.appendChild(r);var a=document.createElement("p");a.innerHTML=""+new Date(e.createdAt).toLocaleString(),t.appendChild(a);var i=document.createElement("p");i.innerHTML="Rating: "+e.rating,t.appendChild(i);var o=document.createElement("p");return o.innerHTML=e.comments,t.appendChild(o),t},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.setAttribute("aria-label","Breadcrumb"),n.innerHTML=e.name,t.appendChild(n)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},addReviewToggle=function(){var e=document.getElementById("reviewToggle");"block"==e.style.display?e.style.display="none":e.style.display="block"},addReview=function(){event.preventDefault();var e={restaurant_id:restaurant.id,name:document.getElementById("author").value,rating:document.querySelector("#rating option:checked").value,comments:document.getElementById("comment").value,id:"",createdAt:new Date};window.addEventListener("online",function(){DBHelper.pushReviewsWhenOnline()}),DBHelper.processNewReview(JSON.stringify(e));var t=document.getElementById("reviews-container"),n=document.getElementById("reviews-list");n.insertBefore(createReviewHTML(e),n.firstChild),t.appendChild(n),document.getElementById("addReviewForm").reset(),addReviewToggle()};navigator.serviceWorker&&window.addEventListener("load",function(){navigator.serviceWorker.register("../sw.js").catch(function(e){console.log("SW registration failed with error: "+e)})});